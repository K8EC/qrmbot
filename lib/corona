#!/usr/bin/perl

# coronavirus info for qrmbot
# written by aa4jq

use strict;
use utf8;
use feature 'unicode_strings';
binmode(STDOUT, ":utf8");

if ($ARGV[0] =~ /about/i){
  print "Current global coronavirus cases as reported by WHO and others. ";
  print "Source: https://www.worldometers.info/coronavirus/coronavirus-cases\n";
  exit 0;
}

# not updating reliably
#my $url = "https://raw.githubusercontent.com/alext234/coronavirus-stats/master/data/who-global-cases.csv";
my $url = "https://www.worldometers.info/coronavirus/coronavirus-cases";

open(HTTP, '-|', "elinks --dump '$url'");
binmode(HTTP, ":utf8");
while (<HTTP>) {
  s/^\s*//;
  s/\[\d+\]//g;
  s/ from\s*//;
  if (/There are currently ([0-9,]+) confirmed cases and ([0-9,]+) deaths/) {
    my ($c,$d) = ($1, $2);
    $c =~ s/,//g;
    $d =~ s/,//g;
    my $pct = sprintf("%0.1f", ($d/$c)*100.0);
    print "$_ ($pct%)\n";
  }
}
close(HTTP);

